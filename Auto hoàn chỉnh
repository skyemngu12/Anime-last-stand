local OrionLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/shlexware/Orion/main/source"))()
local KeyGuardLibrary = loadstring(game:HttpGet("https://cdn.keyguardian.org/library/v1.0.0.lua"))()

local trueData = "0baaee781831405da39f2f7158fe6b29"
local falseData = "bcebbb4e8fb049998cd57634d0015d2d"

KeyGuardLibrary.Set({
    publicToken = "73298d4225c243a9b08431a8d83f8a8f",
    privateToken = "2b0d4d9907e8413ba2abd5a8862c26b6",
    trueData = trueData,
    falseData = falseData,
})

-- File lưu trữ key
local fileName = "KeyStorage.txt"

-- Hàm lưu key vào file
local function saveKeyToFile(key)
    writefile(fileName, key)
end

-- Hàm load key từ file
local function loadKeyFromFile()
    if isfile(fileName) then
        return readfile(fileName)
    else
        return nil
    end
end

-- Kiểm tra key
local function validateKey(key)
    local response = KeyGuardLibrary.validateDefaultKey(key)
    if response == trueData then
        return true
    else
        return false
    end
end

-- Load key từ file
local key = loadKeyFromFile()
local isKeyValid = key and validateKey(key)

-- GUI khi mở chương trình
if not isKeyValid then
    local Window = OrionLib:MakeWindow({
        Name = "Lấy Key",
        HidePremium = false,
        SaveConfig = true,
        IntroEnabled = false,
    })

    local Tab = Window:MakeTab({
        Name = "Key System",
        Icon = "rbxassetid://4483345998",
        PremiumOnly = false
    })

    -- Nhập key
    Tab:AddTextbox({
        Name = "Nhập Key",
        Default = "",
        TextDisappear = false,
        Callback = function(value)
            key = value
        end
    })

    -- Nút kiểm tra key
    Tab:AddButton({
        Name = "Kiểm tra Key",
        Callback = function()
            if validateKey(key) then
                saveKeyToFile(key) -- Lưu key hợp lệ
                OrionLib:MakeNotification({
                    Name = "Key đúng!",
                    Content = "Key của bạn hợp lệ. Đang tải script...",
                    Image = "rbxassetid://4483345998",
                    Time = 5
                })
                wait(1)
                OrionLib:Destroy() -- Xóa GUI
                loadstring(game:HttpGet("https://raw.githubusercontent.com/skyemngu12/Anime-last-stand/refs/heads/main/Guihlw"))()
            else
                OrionLib:MakeNotification({
                    Name = "Key sai!",
                    Content = "Vui lòng thử lại.",
                    Image = "rbxassetid://4483345998",
                    Time = 5
                })
            end
        end
    })

    -- Nút lấy key
    Tab:AddButton({
        Name = "Lấy Key",
        Callback = function()
            setclipboard(KeyGuardLibrary.getLink())
            OrionLib:MakeNotification({
                Name = "Key đã sao chép!",
                Content = "Link lấy key đã được sao chép vào clipboard.",
                Image = "rbxassetid://4483345998",
                Time = 5
            })
        end
    })

    OrionLib:Init()
else
    -- Nếu key hợp lệ, tải ngay script chính
    print("Key đã hợp lệ. Đang tải script...")
    loadstring(game:HttpGet("https://raw.githubusercontent.com/skyemngu12/Anime-last-stand/refs/heads/main/Guihlw"))()
end
